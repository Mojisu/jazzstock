{% extends "layout.html" %}

{% block content %}
<script src="static/js/sorttable.js"></script>
<script language="javascript">
function checkCheckbox(frm,obj,num) {
  var str = obj.name;
  var len = frm.length;

  var chk = 0;
  for(i=0; i<len; i++) {
    if (frm[i].name == str && frm[i].checked == true) {
      chk++;
    }

    if (chk > num) {
      alert("You can only select a maximum of "+num+" checkboxes");
      obj.checked = false;
      break;
    }
  }
}


function setStorage(){
    var q_window = [];
    var q_interval = [];
    var q_order = [];
    var window = document.getElementsByName("window");
    for (var i = 0; i < window.length; i++){

        if(window[i].type =='checkbox' && window[i].checked == true)
        {
            q_window.push(window[i].value)
        }
    }


    var interval = document.getElementsByName("interval");
    for (var i = 0; i < interval.length; i++){

        if(interval[i].type =='checkbox' && interval[i].checked == true)
        {
            q_interval.push(interval[i].value)
        }
    }



    var order = document.getElementsByName("order");
    selectedorderindex = order[0].selectedIndex

    var by = document.getElementsByName("by");
    selectedbyindex = by[0].selectedIndex

    localStorage.setItem("checked_window",q_window);
    localStorage.setItem("checked_interval",q_interval);
    localStorage.setItem("selected_order_index",selectedorderindex);
    localStorage.setItem("selected_order_by",selectedbyindex);

}

function onload(){

    if(localStorage.getItem("checked_window")!=null){
    var q_window = localStorage.getItem("checked_window").split(',')
    }
    else q_window = ['S','YG']

    if(localStorage.getItem("checked_interval")!=null){
    var q_interval = localStorage.getItem("checked_interval").split(',')
    }
    else q_interval = ['1','5','20']

    if(localStorage.getItem("selected_order_index")!=null){
    var selectedorder = localStorage.getItem("selected_order_index")
    }
    else selectedorder = 0

    if(localStorage.getItem("selected_order_by")!=null){
    var selectedby = localStorage.getItem("selected_order_index")
    }
    else selectedby = 0


    var window = document.getElementsByName("window");
    for (var i = 0; i < window.length; i++)
    {


        if(window[i].type =='checkbox' && q_window.includes(window[i].value)){
            window[i].checked=true
        }
    }

    var interval = document.getElementsByName("interval");
    for (var i = 0; i < interval.length; i++)
    {

        if(interval[i].type =='checkbox' && q_interval.includes(interval[i].value)){
            interval[i].checked=true
        }
    }

    document.getElementsByName("order")[0].selectedIndex = selectedorder;
    document.getElementsByName("by")[0].selectedIndex = selectedby;


}


</script>


<body onload="onload()">
<div class="jumbo">
       <h3>
           <a href="http://rubenchu.blog.me/221462571954"> 분석샘플 보기 </a>
        </h3>
</div>
<div class="selection">
     <form method="post" name="form_name" id="form_name">

        <div class="row">
            <div class="col-25">
                WINDOW :
            </div>
            <div class="col-75">
                <input type="checkbox" name="window" value="S" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 사모펀드
                <input type="checkbox" name="window" value="YG" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 연기금
                <input type="checkbox" name="window" value="T"  autocomplete="off"  onClick="checkCheckbox(this.form,this,2)"> 투신
                <input type="checkbox" name="window" value="FN" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 금융
                 <input type="checkbox" name="window" value="IS" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 보험
                 <input type="checkbox" name="window" value="NT" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 국가
                 <input type="checkbox" name="window" value="BK" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 은행
                 <input type="checkbox" name="window" value="OC" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 기타법인
                 <input type="checkbox" name="window" value="PS" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 개인
            </div>
        </div>

        <div class="row">
            <div class="col-25">
                INTERVAL :
            </div>
            <div class="col-75">
                <input type="checkbox" name="interval" value="1" autocomplete="off"  onClick="checkCheckbox(this.form,this,3)"> 1
                <input type="checkbox" name="interval" value="3"  autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 3
                <input type="checkbox" name="interval" value="5" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 5
                <input type="checkbox" name="interval" value="20" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 20
                <input type="checkbox" name="interval" value="60" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 60<br>
            </div>
        </div>

        <div class="row">
            <div class="col-25">
             ORDER BY :
            </div>
            <div class="col-75">


                 <select name="order">
                  <option value="I">기관</option>
                  <option value="F">외인</option>
                  <option value="S">사모펀드</option>
                  <option value="YG">연기금</option>
                  <option value="T">투신</option>
                  <option value="FN">금융</option>
                  <option value="IS">보험</option>
                  <option value="NT">국가</option>
                  <option value="BK">은행</option>
                  <option value="OC">기타법인</option>
                  <option value="PS">개인</option>
                </select>

                 <select name="by">
                  <option value="DESC">내림차순</option>
                  <option value="ASC">오름차순</option>

                </select>

            </div>
        </div>

        <div class="row">
            <div class="col-25">
                DATE (NOT YET) :
            </div>
            <div class="col-75">
                <input type="date" name='date' min="2019-01-01" value="{{date}}">
                <input type="submit" value="검색" onclick="setStorage()">
            </div>
        </div>
    </form>
      <br>
</div>

    <table id="sndrank" class="sortable">
        <tr>

            {% for eachcol in column %}
                {% if eachcol !='DATE'  %}
                    <th>{{eachcol}}</th>
                {% endif %}
            {% endfor %}
        </tr>

        {% for value in sampledata.result %}


        <tr>
            {% for eachcol in column %}
                {% if eachcol =='STOCKNAME'  %}
                    <td class="firstcol">
                            <a href="{{ '/sndChart?stockcode='+ value['STOCKNAME']}}" >
                                {{ value[eachcol] }}
                            </a>
                    </td>

                {% elif eachcol=='CLOSE' %}
                    <td class="money">{{ "{:,}".format(value[eachcol]) }}</td>

                {% elif eachcol!='DATE' %}


                    {% if value[eachcol] != None and value[eachcol]>=0.25 %}
                    <td class="profita" style="background-color: #f72525;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.15 %}
                    <td class="profitb" style="background-color: #ff6247;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.1 %}
                    <td class="profitc" style="background-color: #ff8d7a;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.05 %}
                    <td class="profitd" style="background-color: #ffab9e">

                    {% elif value[eachcol] != None and value[eachcol]>=0.03 %}
                    <td class="profite" style="background-color: #ffe2dd;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.02 %}
                    <td class="profite" style="background-color: #ffefed;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.01 %}
                    <td class="profite" style="background-color: #fff5f4;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.01 %}
                    <td class="profite" style="background-color: #ffffff;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.02 %}
                    <td class="profite" style="background-color: #e5f0ff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.03 %}
                    <td class="profite" style="background-color: #c2dafc;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.05 %}
                    <td class="profite" style="background-color: #a0c7ff;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.1 %}
                    <td class="profite" style="background-color: #75aeff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.15 %}
                    <td class="profite" style="background-color: #5199ff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.25 %}
                    <td class="profite" style="background-color: #247bf7;">
                    {% elif value[eachcol] != None and value[eachcol]<-0.25 %}
                    <td class="profite" style="background-color: #104693;">
                    {% else %}
                    <td class="profite" style="background-color: #ffffff;">



                    {% endif %}
                    {{ "%.2f"|format(value[eachcol]*100) if value[eachcol] != None else '-'}}</td>


                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}



    </table>
</div>
</body>
{% endblock %}